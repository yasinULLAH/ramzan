<!DOCTYPE html>

<html dir="rtl" lang="ur">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>متقی بننے کا رمضان کورس | Ramadan Tracker</title>
<meta content="Complete Ramadan self-assessment course and daily tracker." name="description"/>
<meta content="Yasin Ullah, Pakistan" name="author"/>
<link href="manifest.json" rel="manifest"/>
<meta content="#15803d" name="theme-color"/>
<link href="icon.svg" rel="icon" type="image/svg+xml"/>
<link href="icon.svg" rel="apple-touch-icon"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&amp;display=swap" rel="stylesheet"/>
<script src="lib/tailwindcss.js"></script>
<script src="lib/html2canvas.js"></script>
<script src="lib/confetti.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<style>
        :root {
            --primary-blue: #1e3a8a;
            --border-color: #000;
        }

        body {
            font-family: 'Calibri', sans-serif;
            background-color: #f3f4f6;
            color: #000;
            line-height: 1.8;
        }

        .paper-sheet {
            background: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            max-width: 1400px;
            margin: 0 auto;
            border: 1px solid #ccc;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th,
        td {
            border: 1px solid var(--border-color);
            text-align: center;
            padding: 6px;
            font-size: 1.1rem;
            vertical-align: middle;
        }

        .ashra-table {
            table-layout: auto;
        }

        .ashra-table td {
            white-space: normal;
            word-wrap: break-word;
        }

        .sticky-col {
            position: sticky;
            right: 0;
            background-color: #fff;
            z-index: 10;
            border-left: 2px solid #000;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
        }

        .check-cell {
            height: 100%;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            min-height: 30px;
        }

        .check-cell input {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary-blue);
        }

        .header-title {
            background-color: var(--primary-blue);
            color: white;
            border-radius: 50px;
            padding: 10px 30px;
            box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2);
            line-height: 1.3;
        }

        .input-line {
            border: none;
            border-bottom: 1px dotted #000;
            background: transparent;
            width: 60%;
            outline: none;
            font-family: inherit;
        }

        @media print {
            .no-print {
                display: none;
            }

            .paper-sheet {
                box-shadow: none;
                margin: 0;
                width: 100%;
                max-width: none;
            }

            body {
                background: white;
            }
        }

        .table-container {
            overflow-x: auto;
            width: 100%;
            border: 2px solid #000;
        }

        @keyframes popIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-content {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .mt-4.border-2.border-black.p-2.bg-yellow-50.flex.justify-between.items-center.rounded {
            margin-top: 43px;
        }
    </style>
</head>
<body class="p-2 md:p-6 pb-32">
<div class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 z-50 flex gap-2 no-print justify-center md:justify-end">
<button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2" onclick="app.backupData()">
<i class="fas fa-download"></i> بیک اپ (Save)
        </button>
<button class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2" onclick="app.exportToImage()">
<i class="fas fa-image"></i> تصویر بنائیں (Export)
        </button>
<button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2" onclick="document.getElementById('fileInput').click()">
<i class="fas fa-upload"></i> بحال کریں (Restore)
        </button>
<button class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2" onclick="app.resetData()">
<i class="fas fa-trash"></i> ری سیٹ (Reset)
        </button>
<input accept=".json" class="hidden" id="fileInput" onchange="app.restoreData(this)" type="file"/>
<button class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded shadow-lg flex items-center gap-2 hidden" id="installBtn">
<i class="fas fa-download"></i> انسٹال کریں (Install App)
        </button>
</div>
<div class="paper-sheet p-2 md:p-4 border-4 border-double border-gray-800 relative">
<div class="absolute top-1 left-1 w-4 h-4 border-t-2 border-l-2 border-black"></div>
<div class="absolute top-1 right-1 w-4 h-4 border-t-2 border-r-2 border-black"></div>
<div class="absolute bottom-1 left-1 w-4 h-4 border-b-2 border-l-2 border-black"></div>
<div class="absolute bottom-1 right-1 w-4 h-4 border-b-2 border-r-2 border-black"></div>
<header class="flex flex-col md:flex-row justify-between items-center gap-4 mb-4 border-b-2 border-black pb-4">
<div class="border-2 border-black rounded p-2 text-center text-sm font-bold w-full md:w-1/4">
<p>ہر خانے میں (✓) کا ایک</p>
<p>اور (x) کا صفر نمبر ہے</p>
<div class="mt-2 text-xs border-t border-black pt-1">
                    ایمان داری سے پر کیجیے اور دیکھیے کہ رمضان المبارک میں کیا کھویا کیا پایا
                </div>
</div>
<div class="text-center flex-1">
<div class="flex justify-center items-center gap-2 mb-1">
<i class="fas fa-mosque text-2xl"></i>
<span class="text-xs font-bold uppercase">طالب دعا یسین اللہ</span>
<i class="fas fa-star-and-crescent text-2xl"></i>
</div>
<h1 class="header-title text-2xl md:text-4xl font-extrabold inline-block mb-2">
                    متقی بننے کا رمضان کورس
                </h1>
</div>
<div class="border-2 border-black rounded p-3 w-full md:w-1/4 text-right">
<div class="mb-2">
<label>نام:</label>
<input class="input-line" id="userName" placeholder="آپ کا نام" type="text"/>
</div>
<div>
<label>ولدیت:</label>
<input class="input-line" id="userParentage" placeholder="والد کا نام" type="text"/>
</div>
</div>
</header>
<div class="text-center mb-4 bg-gray-100 border border-gray-400 rounded-full py-1">
<h2 class="text-lg font-bold">خود جائزہ لیجیے کہ اس ماہِ رمضان المبارک میں اللہ پاک کے یہاں آپ کی پوزیشن کیا
                ہے؟</h2>
</div>
<div class="table-container mb-6">
<table id="mainTable">
<thead>
<tr class="bg-gray-200">
<th class="w-64 sticky-col font-bold text-lg">روزمرہ کے معمولات (سوالات)</th>
</tr>
</thead>
<tbody id="dailyRows">
</tbody>
</table>
</div>
<div class="grid grid-cols-1 md:grid-cols-3 gap-0 border-2 border-black">
<div class="border-l-2 border-black p-0">
<div class="bg-gray-100 p-2 text-center font-bold border-b border-black text-base">
                    وہ کام جو عشرے میں کم از کم ایک بار ضرور کرنے ہیں:
                </div>
<table class="w-full ashra-table">
<thead>
<tr class="bg-gray-50 text-base">
<th class="w-1/2">سوال</th>
<th>عشرہ 1</th>
<th>عشرہ 2</th>
<th>عشرہ 3</th>
</tr>
</thead>
<tbody id="ashraRows">
</tbody>
</table>
</div>
<div class="border-l-2 border-black p-0 flex flex-col">
<div class="bg-gray-100 p-2 text-center font-bold border-b border-black text-base">
                    وہ کام جو بہت اہم ہیں ہر ایک (✓) کے پانچ نمبر ہیں
                </div>
<div class="p-2 flex-grow">
<div class="flex items-center justify-between mb-2 border-b border-dotted border-gray-400 pb-1">
<span class="text-base">1. میں نے رمضان المبارک میں ایک مرتبہ قرآن پاک مکمل کیا؟</span>
<input class="w-5 h-5 accent-blue-800" id="quran_complete" type="checkbox"/>
</div>
<div class="flex items-center justify-between mb-2 border-b border-dotted border-gray-400 pb-1">
<span class="text-base">2. میں نے مسائل ، غسل ، وضو ، نماز اور دعائیں سیکھیں؟</span>
<input class="w-5 h-5 accent-blue-800" id="masail_learned" type="checkbox"/>
</div>
<div class="flex items-center justify-between mb-2 border-b border-dotted border-gray-400 pb-1">
<span class="text-base">3. میں نے زکوٰۃ اور صدقۃ الفطر ادا کیا؟</span>
<input class="w-5 h-5 accent-blue-800" id="zakat_paid" type="checkbox"/>
</div>
<div class="flex items-center justify-between mb-2 border-b border-dotted border-gray-400 pb-1">
<span class="text-base">4. میں نے اعتکاف (سنت یا نفلی) کیا؟</span>
<input class="w-5 h-5 accent-blue-800" id="itikaf_done" type="checkbox"/>
</div>
<div class="mt-4">
<p class="text-base font-bold mb-2">5. میں نے آخری عشرہ کی طاق راتوں میں سنت کے مطابق عبادت کی:
                        </p>
<div class="flex flex-wrap gap-2 justify-center text-sm">
<label class="flex flex-col items-center"><input class="w-4 h-4" id="odd_21" type="checkbox"/><span>21 ویں</span></label>
<label class="flex flex-col items-center"><input class="w-4 h-4" id="odd_23" type="checkbox"/><span>23 ویں</span></label>
<label class="flex flex-col items-center"><input class="w-4 h-4" id="odd_25" type="checkbox"/><span>25 ویں</span></label>
<label class="flex flex-col items-center"><input class="w-4 h-4" id="odd_27" type="checkbox"/><span>27 ویں</span></label>
<label class="flex flex-col items-center"><input class="w-4 h-4" id="odd_29" type="checkbox"/><span>29 ویں</span></label>
</div>
</div>
</div>
</div>
<div class="p-0 flex flex-col">
<div class="bg-gray-100 p-2 text-center font-bold border-b border-black text-base">
                    رمضان کا خلاصہ
                </div>
<div class="p-2 flex-grow">
<div class="flex items-center justify-between mb-3 border-b border-dotted border-gray-400 pb-2">
<span class="text-base">کیا آپ نے مکمل رمضان تراویح پڑھی؟</span>
<input class="w-5 h-5 accent-blue-800" id="full_taraweeh" type="checkbox"/>
</div>
<div class="flex items-center justify-between mb-3 border-b border-dotted border-gray-400 pb-2">
<span class="text-base">کیا آپ نے مکمل رمضان روزے رکھے؟</span>
<input class="w-5 h-5 accent-blue-800" id="full_fasts" type="checkbox"/>
</div>
<div class="flex items-center justify-between mb-3 border-b border-dotted border-gray-400 pb-2">
<span class="text-base">کیا آپ نے مکمل رمضان ایک قرآن سنا؟</span>
<input class="w-5 h-5 accent-blue-800" id="full_quran_heard" type="checkbox"/>
</div>
<div class="flex items-center justify-between mb-3 border-b border-dotted border-gray-400 pb-2">
<span class="text-base">کیا میں نے آنکھ، کان اور زبان کی حفاظت کی؟</span>
<input class="w-5 h-5 accent-blue-800" id="self_control" type="checkbox"/>
</div>
<div class="flex items-center justify-between mb-3 border-b border-dotted border-gray-400 pb-2">
<span class="text-base">کیا میں نے امت مسلمہ کے لیے خصوصی دعا کی؟</span>
<input class="w-5 h-5 accent-blue-800" id="ummah_dua" type="checkbox"/>
</div>
</div>
<div class="mt-auto text-center p-2 border-t border-black">
<div class="text-red-700 font-bold text-lg">بندہ یسین اللہ</div>
</div>
</div>
</div>
<div class="mt-4 border-2 border-black p-2 bg-yellow-50 flex flex-col md:flex-row justify-between items-center rounded gap-4">
<span class="font-bold text-lg">کل نمبر (Total Score):</span>
<div class="text-center">
<span class="block text-xl md:text-2xl font-bold text-green-700 font-arabic">الحمد لله رب
                    العالمين</span>
<span class="text-sm font-bold text-gray-600">یا اللہ تیرا شکر ہے (Ya Allah, Thank You)</span>
</div>
<div class="flex items-center gap-4">
<div class="hidden flex items-center gap-2 px-3 py-1 rounded bg-white border border-gray-300" id="badgeDisplay">
<i class="text-2xl text-yellow-500 fas fa-medal" id="badgeIcon"></i>
<span class="font-bold text-lg text-gray-800" id="badgeText"></span>
</div>
<span class="font-bold text-2xl text-blue-900" id="totalScore">0</span>
</div>
</div>
</div>
<div class="h-64 no-print"></div>
<div class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4" id="celebrationModal">
<div class="modal-content bg-white border-4 border-green-600 rounded-lg p-8 max-w-lg w-full text-center shadow-2xl relative">
<button class="absolute top-2 right-2 text-gray-500 hover:text-red-500 text-2xl" onclick="document.getElementById('celebrationModal').classList.add('hidden')">×</button>
<i class="fas fa-crown text-6xl text-yellow-500 mb-4 block"></i>
<h2 class="text-4xl font-bold text-green-700 mb-2 font-arabic">ماشاءاللہ!</h2>
<h3 class="text-2xl font-bold text-gray-800 mb-4">You have achieved &gt;90% Score!</h3>
<div class="bg-green-50 p-4 rounded border border-green-200 mb-6">
<p class="text-lg font-bold text-green-800 mb-2">الحمد لله (Alhamdulillah)</p>
<p class="text-base text-gray-700">Please perform 2 Rakat <strong>Salat-ul-Shukr</strong> (Prayer of
                    Gratitude) to thank Allah for enabling you to be productive this Ramadan.</p>
</div>
<button class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full shadow-lg transform transition hover:scale-105" onclick="document.getElementById('celebrationModal').classList.add('hidden')">
                سبحان اللہ &amp; جزاک اللہ
            </button>
</div>
</div>
<script>
        const app = {
            dbName: 'RamadanTrackerDB',
            storeName: 'userProgress',
            db: null,
            data: {},
            dailyQuestions: [
                "میں نے تہجد کی نماز ادا کی؟",
                "میں نے روزہ رکھا؟",
                "میں نے فجر کی نماز باجماعت ادا کی؟",
                "میں نے فجر کے وقت سورہ یٰسین کی تلاوت کی؟",
                "میں نے سارا دن لڑائی جھگڑا اور جھوٹ سے اجتناب کیا؟",
                "میں نے ظہر کی نماز باجماعت ادا کی؟",
                "عصر کے بعد میں نے نبی کریم ﷺ پر 100 مرتبہ درود بھیجا؟",
                "میں نے کم از کم ایک پارے کی تلاوت کی؟",
                "میں نے عصر کی نماز باجماعت ادا کی؟",
                "میں نے دن میں سو مرتبہ استغفار کیا؟",
                "میں نے مغرب کی نماز باجماعت ادا کی؟",
                "میں نے عشاء کی نماز باجماعت ادا کی اور تراویح بھی پڑھی؟",
                "والدین کی خدمت کی؟"
            ],
            ashraQuestions: [
                "کسی مسلمان بھائی کو اپنے ساتھ افطار کرایا؟",
                "میں نے اللہ کے راستہ میں صدقہ کیا؟",
                "جمعہ کے دن سورہ کہف کی تلاوت کی؟",
                "میں نے 'صلوٰۃ التسبیح' ادا کی؟",
                "ایصال ثواب کیا اور اپنی موت کو یاد کیا؟"
            ],
            init: async function () {
                await this.initDB();
                this.renderTable();
                this.renderAshraTable();
                await this.loadData();
                this.attachListeners();
            },
            initDB: function () {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, 1);
                    request.onupgradeneeded = (event) => {
                        this.db = event.target.result;
                        if (!this.db.objectStoreNames.contains(this.storeName)) {
                            this.db.createObjectStore(this.storeName, { keyPath: 'id' });
                        }
                    };
                    request.onsuccess = (event) => {
                        this.db = event.target.result;
                        resolve();
                    };
                    request.onerror = (event) => reject('DB Error: ' + event.target.errorCode);
                });
            },
            renderTable: function () {
                const theadRow = document.querySelector('#mainTable thead tr');
                for (let i = 1; i <= 30; i++) {
                    const th = document.createElement('th');
                    th.innerText = i;
                    th.className = "w-10 text-center bg-white";
                    theadRow.appendChild(th);
                }
                const tbody = document.getElementById('dailyRows');
                this.dailyQuestions.forEach((q, index) => {
                    const tr = document.createElement('tr');
                    const tdQ = document.createElement('td');
                    tdQ.className = "sticky-col font-medium text-right pr-2 bg-white";
                    tdQ.innerText = (index + 1) + ". " + q;
                    tr.appendChild(tdQ);
                    for (let d = 1; d <= 30; d++) {
                        const td = document.createElement('td');
                        const div = document.createElement('div');
                        div.className = 'check-cell';
                        const input = document.createElement('input');
                        input.type = 'checkbox';
                        input.dataset.type = 'daily';
                        input.dataset.row = index;
                        input.dataset.day = d;
                        input.id = `d_${index}_${d}`;
                        div.appendChild(input);
                        td.appendChild(div);
                        tr.appendChild(td);
                    }
                    tbody.appendChild(tr);
                });
            },
            renderAshraTable: function () {
                const tbody = document.getElementById('ashraRows');
                this.ashraQuestions.forEach((q, index) => {
                    const tr = document.createElement('tr');
                    const tdQ = document.createElement('td');
                    tdQ.className = "text-right pr-2 text-base";
                    tdQ.innerText = (index + 1) + ". " + q;
                    tr.appendChild(tdQ);
                    for (let a = 1; a <= 3; a++) {
                        const td = document.createElement('td');
                        const div = document.createElement('div');
                        div.className = 'check-cell justify-center';
                        const input = document.createElement('input');
                        input.type = 'checkbox';
                        input.dataset.type = 'ashra';
                        input.dataset.row = index;
                        input.dataset.ashra = a;
                        input.id = `a_${index}_${a}`;
                        div.appendChild(input);
                        td.appendChild(div);
                        tr.appendChild(td);
                    }
                    tbody.appendChild(tr);
                });
            },
            saveToDB: function () {
                const inputs = document.querySelectorAll('input');
                const state = { id: 'current_state', timestamp: Date.now() };
                inputs.forEach(input => {
                    if (input.type === 'checkbox') {
                        state[input.id] = input.checked;
                    } else if (input.type === 'text' || input.type === 'file') {
                        if (input.id !== 'fileInput') state[input.id] = input.value;
                    }
                });
                const transaction = this.db.transaction([this.storeName], 'readwrite');
                const store = transaction.objectStore(this.storeName);
                store.put(state);
                this.updateScore();
            },
            loadData: async function () {
                return new Promise((resolve) => {
                    const transaction = this.db.transaction([this.storeName], 'readonly');
                    const store = transaction.objectStore(this.storeName);
                    const request = store.get('current_state');
                    request.onsuccess = (event) => {
                        const result = event.target.result;
                        if (result) {
                            this.applyDataToUI(result);
                        } else {
                            this.populateSampleData();
                        }
                        this.updateScore();
                        resolve();
                    };
                });
            },
            populateSampleData: function () {
                console.log("No previous data found. Starting fresh.");
                this.saveToDB();
                this.saveToDB();
            },
            applyDataToUI: function (data) {
                Object.keys(data).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) {
                        if (el.type === 'checkbox') el.checked = data[key];
                        else if (el.type === 'text') el.value = data[key];
                    }
                });
            },
            attachListeners: function () {
                const inputs = document.querySelectorAll('input');
                inputs.forEach(input => {
                    if (input.id !== 'fileInput') {
                        input.addEventListener('change', () => this.saveToDB());
                        input.addEventListener('input', () => this.saveToDB());
                    }
                });
            },
            exportToImage: function () {
                const element = document.querySelector('.paper-sheet');
                const originalShadow = element.style.boxShadow;
                const originalScrollX = window.scrollX;
                const originalScrollY = window.scrollY;
                window.scrollTo(0, 0);
                element.style.boxShadow = 'none';
                document.fonts.ready.then(() => {
                    html2canvas(element, {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: "#ffffff",
                        scrollY: 0,
                        scrollX: 0,
                        windowWidth: document.documentElement.offsetWidth,
                        windowHeight: document.documentElement.offsetHeight,
                        onclone: (clonedDoc) => {
                            const clonedSheet = clonedDoc.querySelector('.paper-sheet');
                            if (clonedSheet) {
                                clonedSheet.style.transform = 'none';
                                clonedSheet.style.margin = '0 auto';
                                const title = clonedSheet.querySelector('h1.header-title');
                                if (title) {
                                    title.style.transform = 'none';
                                    title.style.marginTop = '0';
                                    title.style.paddingTop = '4px';
                                    title.style.paddingBottom = '16px';
                                    title.style.display = 'inline-block';
                                }
                                const subheaderContainer = clonedSheet.querySelector('.text-center.mb-4.bg-gray-100 h2');
                                if (subheaderContainer) {
                                    subheaderContainer.style.transform = 'translateY(-6px)';
                                    subheaderContainer.style.display = 'inline-block';
                                }
                                const textInputs = clonedSheet.querySelectorAll('input[type="text"]');
                                textInputs.forEach(input => {
                                    const span = clonedDoc.createElement('span');
                                    span.textContent = input.value || input.placeholder;
                                    const styles = getComputedStyle(input);
                                    span.style.fontFamily = styles.fontFamily;
                                    span.style.fontSize = styles.fontSize;
                                    span.style.fontWeight = 'bold';
                                    span.style.borderBottom = '1px dotted #000';
                                    span.style.display = 'inline-block';
                                    span.style.width = input.style.width || '60%';
                                    span.style.textAlign = 'right';
                                    span.style.marginRight = '5px';
                                    if (!input.value) {
                                        span.style.color = '#9ca3af';
                                    } else {
                                        span.style.color = '#000000';
                                    }
                                    input.parentNode.replaceChild(span, input);
                                });
                            }
                        }
                    }).then(canvas => {
                        element.style.boxShadow = originalShadow;
                        window.scrollTo(originalScrollX, originalScrollY);
                        const link = document.createElement('a');
                        link.download = `Ramadan_Tracker_${new Date().toISOString().slice(0, 10)}.png`;
                        link.href = canvas.toDataURL("image/png");
                        link.click();
                    });
                });
            },
            getBadge: function (score) {
                if (score >= 401) return { text: "متقی (Pious)", color: "text-green-600", icon: "fa-crown" };
                if (score >= 251) return { text: "عابد (Devout)", color: "text-blue-600", icon: "fa-star" };
                if (score >= 101) return { text: "طالب (Seeker)", color: "text-yellow-600", icon: "fa-book-open" };
                return { text: "آغاز (Beginning)", color: "text-gray-600", icon: "fa-seedling" };
            },
            updateScore: function () {
                let score = 0;
                document.querySelectorAll('input[data-type="daily"]:checked').forEach(() => score += 1);
                document.querySelectorAll('input[data-type="ashra"]:checked').forEach(() => score += 1);
                const highValueIds = ['quran_complete', 'masail_learned', 'zakat_paid', 'itikaf_done', 'odd_21', 'odd_23', 'odd_25', 'odd_27', 'odd_29', 'full_taraweeh', 'full_fasts', 'full_quran_heard', 'self_control', 'ummah_dua'];
                highValueIds.forEach(id => {
                    if (document.getElementById(id)?.checked) score += 5;
                });
                document.getElementById('totalScore').innerText = score;
                const badge = this.getBadge(score);
                const badgeDisplay = document.getElementById('badgeDisplay');
                const badgeText = document.getElementById('badgeText');
                const badgeIcon = document.getElementById('badgeIcon');
                if (score > 0) {
                    badgeDisplay.classList.remove('hidden');
                    badgeText.innerText = badge.text;
                    badgeIcon.className = `text-2xl fas ${badge.icon} ${badge.color}`;
                } else {
                    badgeDisplay.classList.add('hidden');
                }
            },
            backupData: function () {
                const transaction = this.db.transaction([this.storeName], 'readonly');
                const store = transaction.objectStore(this.storeName);
                const request = store.get('current_state');
                request.onsuccess = (e) => {
                    const data = e.target.result;
                    const blob = new Blob([JSON.stringify(data)], { type: "application/json" });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Ramadan_Tracker_Backup_${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                };
            },
            restoreData: function (inputElement) {
                const file = inputElement.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data && data.id === 'current_state') {
                            this.applyDataToUI(data);
                            this.saveToDB();
                            alert('ڈیٹا کامیابی سے بحال ہو گیا (Data Restored Successfully)');
                        } else {
                            alert('غلط فائل فارمیٹ (Invalid File)');
                        }
                    } catch (err) {
                        alert('فائل پڑھنے میں غلطی (Error reading file)');
                    }
                };
                reader.readAsText(file);
            },
            resetData: function () {
                if (confirm("کیا آپ واقعی تمام ریکارڈ حذف کرنا چاہتے ہیں؟ (Are you sure you want to reset?)")) {
                    const inputs = document.querySelectorAll('input');
                    inputs.forEach(input => {
                        if (input.type === 'checkbox') input.checked = false;
                        if (input.type === 'text') input.value = '';
                    });
                    this.saveToDB();
                }
            }
        };
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (installBtn) installBtn.classList.remove('hidden');
        });
        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                installBtn.classList.add('hidden');
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`User response to the install prompt: ${outcome}`);
                    deferredPrompt = null;
                }
            });
        }
        window.addEventListener('appinstalled', () => {
            if (installBtn) installBtn.classList.add('hidden');
            deferredPrompt = null;
            console.log('PWA was installed');
        });
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
<script type="module">
  import { Workbox } from 'https://storage.googleapis.com/workbox-cdn/releases/7.0.0/workbox-window.prod.mjs';

  const swUrl = './sw.js';
  const wb = new Workbox(swUrl);

  wb.addEventListener('waiting', () => {
    console.log('A new service worker is waiting to activate.');
    wb.messageSW({ type: 'SKIP_WAITING' });
  });

  wb.addEventListener('controlling', () => {
    console.log('The new service worker is now in control. Reloading page for updates...');
    window.location.reload();
  });

  wb.register();
</script></body>
</html>